{"ast":null,"code":"import _regeneratorRuntime from\"C:/CV_projects/Todo-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/CV_projects/Todo-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/CV_projects/Todo-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import classNames from'classnames';import React,{useEffect,useState}from'react';import{createUser,getUserByEmail}from'../../api/users';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var AuthForm=function AuthForm(_ref){var onLogin=_ref.onLogin;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),name=_useState4[0],setName=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),needToRegister=_useState6[0],setNeedToRegister=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),errorMessage=_useState10[0],setErrorMessage=_useState10[1];var saveUser=function saveUser(user){localStorage.setItem('user',JSON.stringify(user));onLogin(user);};useEffect(function(){var userData=localStorage.getItem('user');if(!userData){return;}try{var _user=JSON.parse(userData);onLogin(_user);}catch(error){// Need to login\n}},[]);var loadUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var user;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getUserByEmail(email);case 2:user=_context.sent;if(user){saveUser(user);}else{setNeedToRegister(true);}case 4:case\"end\":return _context.stop();}}},_callee);}));return function loadUser(){return _ref2.apply(this,arguments);};}();var registerUser=function registerUser(){return createUser({name:name,email:email}).then(saveUser);};var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(event){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setErrorMessage('');setLoading(true);_context2.prev=3;if(!needToRegister){_context2.next=9;break;}_context2.next=7;return registerUser();case 7:_context2.next=11;break;case 9:_context2.next=11;return loadUser();case 11:_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](3);setErrorMessage('Something went wrtong');case 16:_context2.prev=16;setLoading(false);return _context2.finish(16);case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[3,13,16,19]]);}));return function handleSubmit(_x){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"box mt-5\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"title is-3\",children:needToRegister?'You need to register':'Log in to open todos'}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",htmlFor:\"user-email\",children:\"Email\"}),/*#__PURE__*/_jsxs(\"div\",{className:classNames('control has-icons-left',{'is-loading':loading}),children:[/*#__PURE__*/_jsx(\"input\",{type:\"email\",id:\"user-email\",className:classNames('input',{'is-danger':!needToRegister&&errorMessage}),placeholder:\"Enter your email\",disabled:loading||needToRegister,value:email,required:true,onChange:function onChange(e){return setEmail(e.target.value);}}),/*#__PURE__*/_jsx(\"span\",{className:\"icon is-small is-left\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-envelope\"})})]}),!needToRegister&&errorMessage&&/*#__PURE__*/_jsx(\"p\",{className:\"help is-danger\",children:errorMessage})]}),needToRegister&&/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",htmlFor:\"user-name\",children:\"Your Name\"}),/*#__PURE__*/_jsxs(\"div\",{className:classNames('control has-icons-left',{'is-loading':loading}),children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"user-name\",className:classNames('input',{'is-danger':needToRegister&&errorMessage}),placeholder:\"Enter your name\",required:true,minLength:4,disabled:loading,value:name,onChange:function onChange(e){return setName(e.target.value);}}),/*#__PURE__*/_jsx(\"span\",{className:\"icon is-small is-left\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-user\"})})]}),needToRegister&&errorMessage&&/*#__PURE__*/_jsx(\"p\",{className:\"help is-danger\",children:errorMessage})]}),/*#__PURE__*/_jsx(\"div\",{className:\"field\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:classNames('button is-primary',{'is-loading':loading}),children:needToRegister?'Register':'Login'})})]});};","map":{"version":3,"names":["classNames","React","useEffect","useState","createUser","getUserByEmail","AuthForm","onLogin","email","setEmail","name","setName","needToRegister","setNeedToRegister","loading","setLoading","errorMessage","setErrorMessage","saveUser","user","localStorage","setItem","JSON","stringify","userData","getItem","parse","error","loadUser","registerUser","then","handleSubmit","event","preventDefault","e","target","value"],"sources":["C:/CV_projects/Todo-app/src/components/Auth/AuthForm.tsx"],"sourcesContent":["import classNames from 'classnames';\nimport React, { useEffect, useState } from 'react';\nimport { createUser, getUserByEmail } from '../../api/users';\nimport { User } from '../../types/User';\n\nexport type Props = {\n  onLogin: (user: User) => void,\n};\n\nexport const AuthForm: React.FC<Props> = ({ onLogin }) => {\n  const [email, setEmail] = useState('');\n  const [name, setName] = useState('');\n  const [needToRegister, setNeedToRegister] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [errorMessage, setErrorMessage] = useState('');\n\n  const saveUser = (user: User) => {\n    localStorage.setItem('user', JSON.stringify(user));\n    onLogin(user);\n  };\n\n  useEffect(() => {\n    const userData = localStorage.getItem('user');\n\n    if (!userData) {\n      return;\n    }\n\n    try {\n      const user = JSON.parse(userData) as User;\n\n      onLogin(user);\n    } catch (error) {\n      // Need to login\n    }\n  }, []);\n\n  const loadUser = async () => {\n    const user = await getUserByEmail(email);\n\n    if (user) {\n      saveUser(user);\n    } else {\n      setNeedToRegister(true);\n    }\n  };\n\n  const registerUser = () => {\n    return createUser({ name, email })\n      .then(saveUser);\n  };\n\n  const handleSubmit = async (event: React.FormEvent) => {\n    event.preventDefault();\n\n    setErrorMessage('');\n    setLoading(true);\n\n    try {\n      if (needToRegister) {\n        await registerUser();\n      } else {\n        await loadUser();\n      }\n    } catch (error) {\n      setErrorMessage('Something went wrtong');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"box mt-5\">\n      <h1 className=\"title is-3\">\n        {needToRegister ? 'You need to register' : 'Log in to open todos'}\n      </h1>\n\n      <div className=\"field\">\n        <label className=\"label\" htmlFor=\"user-email\">\n          Email\n        </label>\n\n        <div\n          className={classNames('control has-icons-left', {\n            'is-loading': loading,\n          })}\n        >\n          <input\n            type=\"email\"\n            id=\"user-email\"\n            className={classNames('input', {\n              'is-danger': !needToRegister && errorMessage,\n            })}\n            placeholder=\"Enter your email\"\n            disabled={loading || needToRegister}\n            value={email}\n            required\n            onChange={e => setEmail(e.target.value)}\n          />\n\n          <span className=\"icon is-small is-left\">\n            <i className=\"fas fa-envelope\" />\n          </span>\n        </div>\n\n        {!needToRegister && errorMessage && (\n          <p className=\"help is-danger\">{errorMessage}</p>\n        )}\n      </div>\n\n      {needToRegister && (\n        <div className=\"field\">\n          <label className=\"label\" htmlFor=\"user-name\">\n            Your Name\n          </label>\n\n          <div\n            className={classNames('control has-icons-left', {\n              'is-loading': loading,\n            })}\n          >\n            <input\n              type=\"text\"\n              id=\"user-name\"\n              className={classNames('input', {\n                'is-danger': needToRegister && errorMessage,\n              })}\n              placeholder=\"Enter your name\"\n              required\n              minLength={4}\n              disabled={loading}\n              value={name}\n              onChange={e => setName(e.target.value)}\n            />\n\n            <span className=\"icon is-small is-left\">\n              <i className=\"fas fa-user\" />\n            </span>\n          </div>\n\n          {needToRegister && errorMessage && (\n            <p className=\"help is-danger\">{errorMessage}</p>\n          )}\n        </div>\n      )}\n\n      <div className=\"field\">\n        <button\n          type=\"submit\"\n          className={classNames('button is-primary', {\n            'is-loading': loading,\n          })}\n        >\n          {needToRegister ? 'Register' : 'Login'}\n        </button>\n      </div>\n    </form>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}